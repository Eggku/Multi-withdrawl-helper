name: Build and Release MultiWithdrawalHelper

on:
  push:
    branches:
      - main  # ğŸš€ å½“ä»£ç æ¨é€åˆ° `main` åˆ†æ”¯æ—¶è§¦å‘æ„å»º
  workflow_dispatch:  # âœ… å…è®¸æ‰‹åŠ¨è¿è¡Œå·¥ä½œæµ

jobs:
  build:
    runs-on: windows-latest  # ğŸ–¥ è¿è¡Œ Windows æœåŠ¡å™¨ï¼ˆç”¨äºæ‰“åŒ… .exeï¼‰
    permissions:
      contents: write

    steps:
      - name: ğŸ›  æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ğŸ›  å®‰è£… Python ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
        shell: pwsh

      - name: âš™ï¸ æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
        run: python build.py
        shell: pwsh

      - name: ğŸš€ ä¸Šä¼ æ„å»ºäº§ç‰©ï¼ˆMultiWithdrawalHelper.exeï¼‰
        uses: actions/upload-artifact@v4
        with:
          name: MultiWithdrawalHelper
          path: dist_packages/MultiWithdrawalHelper_v*/MultiWithdrawalHelper.exe

  release:
    needs: build
    runs-on: ubuntu-latest  # ğŸš€ åœ¨ Linux ç¯å¢ƒæ‰§è¡Œå‘å¸ƒä»»åŠ¡
    permissions:
      contents: write

    steps:
      - name: ğŸ›  æ£€å‡ºä»£ç 
        uses: actions/checkout@v3

      - name: ğŸš€ ä¸‹è½½æ„å»ºäº§ç‰©
        uses: actions/download-artifact@v3
        with:
          name: MultiWithdrawalHelper
          path: release_files

      - name: ğŸš€ åˆ›å»º GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: release_files/MultiWithdrawalHelper.exe  # âœ… ä¸Šä¼  `MultiWithdrawalHelper.exe`
          tag_name: latest
          name: "MultiWithdrawalHelper Release"
          body: |
            ğŸ”¥ **æ–°ç‰ˆæœ¬å‘å¸ƒï¼**
            - ğŸ¯ è‡ªåŠ¨æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶
            - ğŸš€ ç‰ˆæœ¬å·: `${{ github.sha }}`
          draft: false
          prerelease: false
